### ================================================
### 测试任务转交流程 (最终语法修正版)
### ================================================

# --- 准备工作：确保我们有需要的用户 ---

# @name login_as_admin
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "admin",
  "password": "Password123!@#"
}

### (Admin) 创建 Manager 用户
POST http://localhost:8080/api/v1/admin/users
Content-Type: application/json
Authorization: Bearer {{login_as_admin.response.body.token}}

{
  "username": "manager_final",
  "password": "Password123!@#",
  "real_name": "项目经理-最终",
  "role": "manager"
}

### (Admin) 创建 Executor 用户 1
POST http://localhost:8080/api/v1/admin/users
Content-Type: application/json
Authorization: Bearer {{login_as_admin.response.body.token}}

{
  "username": "executor_final_1",
  "password": "Password123!@#",
  "real_name": "核心执行人-最终1",
  "role": "executor"
}

### (Admin) 创建 Executor 用户 2
POST http://localhost:8080/api/v1/admin/users
Content-Type: application/json
Authorization: Bearer {{login_as_admin.response.body.token}}

{
  "username": "executor_final_2",
  "password": "Password123!@#",
  "real_name": "核心执行人-最终2",
  "role": "executor"
}


# --- 流程开始 ---

# 步骤1: Manager登录，并创建一个任务，然后审批它
@name login_as_manager
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "manager_final",
  "password": "Password123!@#"
}

###
@name create_task_for_transfer
POST http://localhost:8080/api/v1/tasks
Content-Type: application/json
Authorization: Bearer {{login_as_manager.response.body.token}}

{
    "title": "需要被转交的最终测试任务",
    "priority": "P0",
    "effort": 30,
    "task_type_id": "请在这里粘贴一个您数据库中task_types表的真实ID"
}

###
POST http://localhost:8080/api/v1/tasks/{{create_task_for_transfer.response.body.id}}/approve
Authorization: Bearer {{login_as_manager.response.body.token}}


# 步骤2: executor_1 登录并领取这个任务
@name login_as_executor1
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "executor_final_1",
  "password": "Password123!@#"
}

###
POST http://localhost:8080/api/v1/tasks/{{create_task_for_transfer.response.body.id}}/claim
Authorization: Bearer {{login_as_executor1.response.body.token}}


# 步骤3: executor_2 登录
@name login_as_executor2
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "executor_final_2",
  "password": "Password123!@#"
}

### 步骤4: executor_1 发起转交，将任务转给 executor_2
@name initiate_transfer
POST http://localhost:8080/api/v1/tasks/{{create_task_for_transfer.response.body.id}}/transfer
Content-Type: application/json
Authorization: Bearer {{login_as_executor1.response.body.token}}

{
    "new_assignee_id": "{{login_as_executor2.response.body.user_id}}",
    "effort_spent": 5
}


### 步骤5: executor_2 接受转交
POST http://localhost:8080/api/v1/transfers/{{initiate_transfer.response.body.transfer_id}}/accept
Authorization: Bearer {{login_as_executor2.response.body.token}}