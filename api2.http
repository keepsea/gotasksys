### ================================================
### 测试任务驳回与重提完整流程
### ================================================

# --- 步骤 1: Creator登录 ---
# 我们先用 creator_new 登录，获取他的token
# @name login_as_creator_for_rejection_test
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "creator_new",
  "password": "Password123!@#"
}

@creator_token = {{login_as_creator_for_rejection_test.response.body.token}}

### --- 步骤 2: Creator创建一个新任务 ---
# 这个任务将被用于后续的驳回和重提
# @name create_task_for_rejection_test
POST http://localhost:8080/api/v1/tasks
Content-Type: application/json
Authorization: Bearer {{creator_token}}

{
    "title": "待驳回与重提的测试任务2",
    "description": "此任务用于完整测试驳回和重提流程。",
    "priority": "P2",
    "effort": 4,
    "task_type_id": "a65797dd-6e85-412b-897d-d59e3adb9084"
}

# 捕获新创建任务的ID，存入变量中
@rejection_test_task_id = {{create_task_for_rejection_test.response.body.id}}


### --- 步骤 3: Manager登录 ---
# @name login_as_manager_for_rejection_test
POST http://localhost:8080/api/v1/login
Content-Type: application/json

{
  "username": "manager_new",
  "password": "Password123!@#"
}

@manager_token = {{login_as_manager_for_rejection_test.response.body.token}}


### --- 步骤 4: Manager驳回该任务 ---
# 使用 manager 的 token 和上一步获取的任务ID
POST http://localhost:8080/api/v1/tasks/{{rejection_test_task_id}}/reject
Content-Type: application/json
Authorization: Bearer {{manager_token}}

{
  "reason": "任务描述不够清晰，请补充详细的执行步骤。"
}


# --- 步骤 5: 手动检查数据库 ---
# 此时，请您在数据库工具中查看 tasks 表中 ID 为 {{rejection_test_task_id}} 的任务。
# 预期结果:
# 1. status 字段应变为 "rejected"。
# 2. rejection_reason 字段应包含我们上面填写的理由。
# 检查完毕后，再执行下一步。


### --- 步骤 6: Creator重新提交该任务 ---
# 注意：我们使用步骤1中获取到的 @creator_token
POST http://localhost:8080/api/v1/tasks/{{rejection_test_task_id}}/resubmit
Authorization: Bearer {{creator_token}}


# --- 步骤 7: 再次手动检查数据库 ---
# 此时，请您再次在数据库工具中

